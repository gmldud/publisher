---
title: A/B 테스트가 불가능 한 경우 이 글을 보세요.
slug: If-ab-testing-is-not-possible,-see-this-article.
category: "Causal Inference"
keywords: ["Product Analytics", "Causal Inference", "PAP"]
author: "김희영"
tags: ["초급", "인과추론","관찰실험"]
date: 2022-07-15
thumbnail: ../../../assets/season2_thumbnail.png
private: false
draft: false
---


## 시간 절약 체크리스트.

<br/>

해당 글은 아래의 경우에 해당하는 분들께 도움이 될 수 있습니다.

- a/b 테스트에 관심이 있으신 분
- a/b 테스트를 공부하고 계신 분
- a/b 테스트를 실무에 적용 중인 데이터 분석가
- a/b 테스트를 사용하는 실무자와 협력관계에 있는 모든 이해관계자
- 인과 추론을 공부하고 계신 분

<br/>

## 이 글을 쓰게 된 이유

PAP에서 a/b 테스트 스터디에 참여하며 얻은 지식을 공유하고자 본 글을 작성합니다.<br/>
a/b 테스트가 네카라쿠배당토를 시작으로 점점 더 많은 기업의 실험 문화로 자리 잡고 있습니다.<br/>
실험 문화가 정착해가면서, 몇몇 기업은 각기 다른 상황과 조건에 의해 a/b 테스트를 진행하지 못하는 경우도 발생하고 있습니다.
**본 글에서는 이처럼 a/b 테스트가 불가능한 경우, 진행할 수 있는 실험 방법에 대한 내용을 다룹니다.**

<br/>

## a/b 테스트는 항상 가능할까?

**a/b 테스트란 뭘까요?** <br/>
a/b 테스트는 무작위 통제 실험입니다. 실험에 투입될 표본 집단을 "무작위"로 선정하여, 집단을 a와 b 그룹으로 나누어 조건을 달리 "통제"하여 진행하는 실험이 a/b 테스트 입니다.
<br/><br/>
**여기서 표본 집단을 "무작위"로 선정한다는 것은 어떤 의미가 있을까요?**
<br/>
표본 집단을 무작위로 선정하는 것은 해당 표본 집단이 무작위로 선출되어도 모집단을 대표할 수 있는 집단이라는 가설이 기반으로 합니다.<br/>
예를 들어봅시다. 교실에 전체 인원 20명이 있으면, 이 20명은 모집단이 됩니다.<br/>
전체 인원 중 6명의 표본 집단을 뽑아 실험을 진행하기로 하였고, 이 6명은 전체 인원 20명을 대표한다는 가설을 기반으로 합니다.<br/>
6명에게 실험을 진행하고, 우리는 표본 집단을 통해 나온 실험 결과를 신뢰합니다.
<br/>
즉, 무작위로 선정된 표본 집단을 통한 실험 결과가, 모집단에 해당 실험을 진행했을 때, 동일한 결과가 도출된다는 뜻을 나타냅니다.

**하지만 모집단에서 "무작위"로 추출한 표본 집단이 항상 모집단을 대표할 수 있을까요?**<br/>
무작위로 추출한 표본 집단이 모집단을 대표하려면, 우선 무작위성을 부여할 수 있는 조건과 일정 수 이상의 모집단이 확보되어야 합니다. 즉, 무작위로 추출된 표본 집단은 "항상" 모집단을 대표할 수 있는 것이 아닙니다.<br/>
위와 같은 조건은 모든 기업에게 충족 가능한 조건이 아닙니다. 그렇기에 a/b 테스트는 항상 실행 가능하지 않고, 우리는 a/b 테스트가 불가능한 경우의 실험 방법을 알아야 합니다.

<br/>

## a/b 테스트가 불가능하다면?

**a/b 테스트가 인과성을 입증하기 위한 안정적인 방법이지만, 위에서도 설명했듯 a/b 테스트가 항상 쓸 수 있는 방법은 아닙니다.**<br/>
조금 더 낮은 수준의 신뢰도이지만 수집된 데이터를 활용해 인과성을 밝히는 데 관찰 연구(observational causal studies)를 활용할 수 있습니다.

**관찰 연구(observational causal studies)란?**<br/>
a/b 테스트가 모집단을 대표하는 표본 집단을 뽑아서 일반화가 가능하도록 하는 "실험 연구" 였다면, **관찰 연구(observational causal studies)**는 표본 집단을 잘 뽑을 수도 없으며, 있는 현상을 그냥 충실하게 기술하는 것입니다.<br/>
(쉽게 말해 연구 방법은 실험 연구, 관찰 연구로 나뉘고 각 연구를 하기 위한 여러 방법이 존재하는 것입니다. 본 글에서는 실험 연구 방법으로는 a/b 테스트가 있다고 설명하고, 관찰 연구 방법으로는 회귀 불연속, 도구 변수, 성향 점수 매칭, 이중차분법을 설명합니다. 각 연구에는 더 다양한 방법이 존재할 수 있습니다.)

**관찰 연구(observational causal studies)에서의 어려움**<br/>
관찰 연구는 실험 연구와 달리 표본 집단 추출 자체가 어렵기 때문에 아래 두 가지 여려움을 갖고 있습니다.
그렇기에 실험을 설계할 때, 항상 아래 두 가지 사항에 대한 답을 할 수 있는지 확인해야 합니다.
- **비교를 위한 control 그룹과 treatment 그룹을 어떻게 만들 것인가?**
- **control 그룹과 treatment 그룹이 주어졌을 때 그 효과 차이를 어떻게 모델링 할 것인가?**

<br/>

## observational causal studies - regression discontinuity design (관찰 인과 연구 - 회귀 불연속)

불연속 회귀 설계(RDD; Regression Discontinuity Design)는 인과 추론 방법 중 하나입니다.<br/>
해당 방법은 처치(treatment)가 특정 제약 조건이나 자격 하에 정해지는 경우에 사용합니다.<br/>
처치가 랜덤하게 배정되지 않기 때문에 실험군, 대조군 간 처치를 제외한 다른 특성이 동일하지 않은 경우입니다.

어떤 케이스에 회귀 불연속 설계를 사용하면 좋은지 2가지 사례를 통해 살펴보겠습니다.

**사례1(법적 최소 음주연령)**<br/>
그 예로 음주가 사망에 영향을 미치는 인과 관계를 확인하기 위해 캐나다에서 시행한 MLDA(법적 최소 음주 연령) 제도에 초점을 맞춰 분석한 사례가 있습니다.

MLDA는 음주를 허용하는 최소 연령을 21세로 규제한 제도인데 이로 인해 분석에서 처치인 음주 여부가 연령에 의해 정해집니다.

처치(음주)는 다른 요인인 연령을 기준으로 정해지므로 아래와 같이 실험군(treated group), 대조군(control group)이 나뉩니다.

실험군 : 음주가 가능한 만 21세 이상<br/>
대조군 : 음주가 불가능한 만 21세 미만<br/>
여기서 처치 여부를 결정하는 변수를 "배정 변수"라고 하며, 처치 여부가 결정되는 배정 변수의 값을 "임계값"이라고 합니다

배정 변수 : 연령, 임계값 : 21세<br/>
배정 변수 : 시험 점수, 임계값 : s<br/>
즉, 연령이라는 특정 제약에 의해 처치가 정해지므로 이 두 그룹의 사망 여부를 단순 비교하는 경우 연령에 의한 영향이 포함되어 명확한 인과 효과 추정이 어렵습니다.

<br/>

**사례2(대학 진학 여부가 소득에 미치는 영향)**<br/>
또 다른 사례로 "좋은 대학에 들어가는 것이 향후 소득에 영향을 미치는지" 인과 관계를 분석하는 것을 생각해 볼 수 있습니다.

본 케이스도 마찬가지로 대학에 들어가는지 여부(처치)가 시험 점수에 의해 정해지기 때문에 특정 제약 조건 하에 처치가 정해지는 케이스입니다. 애초에 두 그룹 간의 특성이 다른 상태인 것입니다.

실험군 : 시험 점수(s)를 넘겨 해당 대학에 진학한 학생<br/>
대조군 : 시험 점수(s)를 넘기지 못해 해당 대학에 진학하지 못한 학생<br/>
이러한 경우도 회귀 불연속 설계를 사용하여 인과 효과를 추정해 볼 수 있습니다.

<br/>

**회귀 불연속 설계에서 중요한 가정은 처치가 오로지 배정 변수에 의해 결정된다는 것입니다. 때문에 이 가정 하에서는 아래의 논리를 주장할 수 있습니다.**

- 배정 변수에 의해 처치가 결정되지 않았다면 결과 변수는 배정 변수 임계값 근방에서 단절이 일어나지 않고 연속적일 것이다(contuous assumption)

즉, 처치를 받은 그룹의 처치를 받지 않았을 때의 결과(반사실)를 처치를 받지 않은 부분의 연결선으로 간주할 수 있다는 것입니다. (처치 그룹이나 처치 받지 않은 그룹이나 같다. = 실험군 대조군이 구분이 안됐다.)

<br/>

## observational causal studies - instrumented variables (관찰 인과 연구 - 도구변수)

<br/>

## observational causal studies - propensity score matching (관찰 인과 연구 - 성향 점수 매칭)

<br/>

## observational causal studies - difference in differences (관찰 인과 연구 - 이중차분법)

<br/>

## 함정

<br/>

## 정리

1. a/b 테스트같이 통제가 많이 필요한 실험이 불가능한 경우 관찰 인과 연구(observational causal studies)가 도움이 될 수 있다.
2. 관찰 인과 연구 설계 방법에는 회귀 불연속 설계, 도구 변수 기법과 자연 실험, 성향 점수 매칭, 이중차분법이 있다.
3. 회귀 불연속 설계와 도구 변수 기법이 불가능할 때, 이중차분법을 사용할 수 있다.
4. a/b 테스트의 대안으로 관찰 인과 연구가 사용될 수 있으나, 관찰 인과 연구에는 낮은 신뢰성, 더 많은 가정을 필요로 한다는 한계를 갖고 있다.

<br/>

## outro
a/b 테스트 스터디를 같이 한 모든 스터디원, 그리고 해당 글을 작성할 수 있도록 관찰 인과 연구에 대한 이해를 도와주신 오채환님 감사합니다.
